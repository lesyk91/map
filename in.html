<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞—Ä—Ç–∞ –Ü–ª–ª—ñ–Ω—Ü—ñ–≤ –∑ 150 —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—è–º–∏</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    #map { height: 600px; width: 100%; }
    .info { padding: 10px; background: white; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .hidden { display: none; }
    .login-form, .edit-form { max-width: 400px; margin: 20px auto; padding: 20px; background: #f9f9f9; border-radius: 10px; }
  </style>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold text-center mb-4">–ö–∞—Ä—Ç–∞ –Ü–ª–ª—ñ–Ω—Ü—ñ–≤</h1>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥—É —Ç–∞ —Ñ–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó -->
    <div id="auth-section" class="text-center mb-4">
      <button id="login-btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">–£–≤—ñ–π—Ç–∏</button>
      <button id="logout-btn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 hidden">–í–∏–π—Ç–∏</button>
      <div id="login-form" class="login-form hidden">
        <input type="text" id="username" placeholder="–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" class="w-full p-2 mb-2 border rounded">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full p-2 mb-2 border rounded">
        <button id="submit-login" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">–£–≤—ñ–π—Ç–∏</button>
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
    <div class="flex justify-center space-x-4 mb-4">
      <button id="my-location" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">üìç –ü–æ–∫–∞–∑–∞—Ç–∏ –º–æ—î –º—ñ—Å—Ü–µ</button>
      <button id="layers" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">üó∫ –®–∞—Ä–∏</button>
    </div>

    <!-- –ö–∞—Ä—Ç–∞ -->
    <div id="map"></div>

    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö) -->
    <div id="edit-section" class="edit-form hidden">
      <h2 class="text-xl font-bold mb-2">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—é</h2>
      <input type="hidden" id="edit-id">
      <input type="text" id="edit-received" placeholder="–î–∞—Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è" class="w-full p-2 mb-2 border rounded">
      <input type="text" id="edit-processed" placeholder="–î–∞—Ç–∞ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è" class="w-full p-2 mb-2 border rounded">
      <input type="text" id="edit-bulletin" placeholder="–í—ñ—Å–Ω–∏–∫" class="w-full p-2 mb-2 border rounded">
      <input type="text" id="edit-additional" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤–æ" class="w-full p-2 mb-2 border rounded">
      <button id="save-edit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </div>

    <!-- –Ü—Å—Ç–æ—Ä—ñ—è (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö) -->
    <div id="history-section" class="hidden">
      <h2 class="text-xl font-bold text-center mb-2">–Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω</h2>
      <div id="history" class="bg-white p-4 rounded shadow"></div>
      <button id="export-history" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-2">–ï–∫—Å–ø–æ—Ä—Ç —ñ—Å—Ç–æ—Ä—ñ—ó</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏
    const map = L.map('map').setView([49.105, 29.210], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // –ó—Ä–∞–∑–æ–∫ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (–∑–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π –±–µ–∫–µ–Ω–¥)
    let territories = Array.from({ length: 150 }, (_, i) => ({
      id: i + 1,
      name: `–¢–µ—Ä–∏—Ç–æ—Ä—ñ—è ${i + 1}`,
      coords: [
        [49.105 + (i % 10) * 0.01, 29.210 + Math.floor(i / 10) * 0.01],
        [49.105 + (i % 10) * 0.01 + 0.005, 29.210 + Math.floor(i / 10) * 0.01],
        [49.105 + (i % 10) * 0.01 + 0.005, 29.210 + Math.floor(i / 10) * 0.01 + 0.005],
        [49.105 + (i % 10) * 0.01, 29.210 + Math.floor(i / 10) * 0.01 + 0.005]
      ],
      data: { received: '', processed: '', bulletin: '', additional: '' },
      history: []
    }));

    let isAuthenticated = false;

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–µ—Ä–∏—Ç–æ—Ä—ñ–π
    territories.forEach(territory => {
      const polygon = L.polygon(territory.coords, { color: 'blue' }).addTo(map);
      polygon.bindPopup(`
        <b>${territory.name}</b><br>
        <a href="https://www.openstreetmap.org/directions?from=&to=${territory.coords[0][0]},${territory.coords[0][1]}" target="_blank">–ü—Ä–æ–∫–ª–∞—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç</a>
        <div class="info ${isAuthenticated ? '' : 'hidden'}">
          <b>–î–∞—Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è:</b> ${territory.data.received || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}<br>
          <b>–î–∞—Ç–∞ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è:</b> ${territory.data.processed || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}<br>
          <b>–í—ñ—Å–Ω–∏–∫:</b> ${territory.data.bulletin || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}<br>
          <b>–î–æ–¥–∞—Ç–∫–æ–≤–æ:</b> ${territory.data.additional || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}<br>
          <button onclick="editTerritory(${territory.id})" class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
        </div>
      `);
    });

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –º–æ—î –º—ñ—Å—Ü–µ
    document.getElementById('my-location').addEventListener('click', () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          const { latitude, longitude } = position.coords;
          map.setView([latitude, longitude], 13);
          L.marker([latitude, longitude]).addTo(map)
            .bindPopup('–í–∏ —Ç—É—Ç!').openPopup();
        }, () => alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –º—ñ—Å—Ü–µ'));
      } else {
        alert('–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è');
      }
    });

    // –®–∞—Ä–∏ (–ø—Ä–∏–∫–ª–∞–¥)
    document.getElementById('layers').addEventListener('click', () => {
      alert('–¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —à–∞—Ä—ñ–≤: —Å—É–ø—É—Ç–Ω–∏–∫, –¥–æ—Ä–æ–≥–∏ —Ç–æ—â–æ');
    });

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
    document.getElementById('login-btn').addEventListener('click', () => {
      document.getElementById('login-form').classList.toggle('hidden');
    });

    document.getElementById('submit-login').addEventListener('click', () => {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      // –ó—Ä–∞–∑–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó (–∑–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π –±–µ–∫–µ–Ω–¥)
      if (username === 'admin' && password === 'password') {
        isAuthenticated = true;
        document.getElementById('login-btn').classList.add('hidden');
        document.getElementById('logout-btn').classList.remove('hidden');
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('edit-section').classList.remove('hidden');
        document.getElementById('history-section').classList.remove('hidden');
        updateMap();
        updateHistory();
      } else {
        alert('–ù–µ–≤—ñ—Ä–Ω–µ —ñ–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –ø–∞—Ä–æ–ª—å');
      }
    });

    document.getElementById('logout-btn').addEventListener('click', () => {
      isAuthenticated = false;
      document.getElementById('login-btn').classList.remove('hidden');
      document.getElementById('logout-btn').classList.add('hidden');
      document.getElementById('edit-section').classList.add('hidden');
      document.getElementById('history-section').classList.add('hidden');
      updateMap();
    });

    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó
    window.editTerritory = function(id) {
      if (!isAuthenticated) return;
      const territory = territories.find(t => t.id === id);
      document.getElementById('edit-id').value = id;
      document.getElementById('edit-received').value = territory.data.received;
      document.getElementById('edit-processed').value = territory.data.processed;
      document.getElementById('edit-bulletin').value = territory.data.bulletin;
      document.getElementById('edit-additional').value = territory.data.additional;
    };

    document.getElementById('save-edit').addEventListener('click', () => {
      const id = parseInt(document.getElementById('edit-id').value);
      const territory = territories.find(t => t.id === id);
      const newData = {
        received: document.getElementById('edit-received').value,
        processed: document.getElementById('edit-processed').value,
        bulletin: document.getElementById('edit-bulletin').value,
        additional: document.getElementById('edit-additional').value
      };
      const timestamp = new Date().toISOString();
      territory.history.push({ timestamp, ...territory.data });
      territory.data = newData;
      updateMap();
      updateHistory();
      // –°–∫–∏–¥–∞—î–º–æ —Ñ–æ—Ä–º—É
      document.getElementById('edit-id').value = '';
      document.getElementById('edit-received').value = '';
      document.getElementById('edit-processed').value = '';
      document.getElementById('edit-bulletin').value = '';
      document.getElementById('edit-additional').value = '';
    });

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏
    function updateMap() {
      map.eachLayer(layer => {
        if (layer instanceof L.Polygon) map.removeLayer(layer);
      });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);
      territories.forEach(territory => {
        const polygon = L.polygon(territory.coords, { color: 'blue' }).addTo(map);
        polygon.bindPopup(`
          <b>${territory.name}</b><br>
          <a href="https://www.openstreetmap.org/directions?from=&to=${territory.coords[0][0]},${territory.coords[0][1]}" target="_blank">–ü—Ä–æ–∫–ª–∞—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç</a>
          <div class="info ${isAuthenticated ? '' : 'hidden'}">
            <b>–î–∞—Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è:</b> ${territory.data.received || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}<br>
            <b>–î–∞—Ç–∞ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è:</b> ${territory.data.processed || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}<br>
            <b>–í—ñ—Å–Ω–∏–∫:</b> ${territory.data.bulletin || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}<br>
            <b>–î–æ–¥–∞—Ç–∫–æ–≤–æ:</b> ${territory.data.additional || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}<br>
            <button onclick="editTerritory(${territory.id})" class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
          </div>
        `);
      });
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
    function updateHistory() {
      const historyDiv = document.getElementById('history');
      historyDiv.innerHTML = '';
      territories.forEach(territory => {
        territory.history.forEach(entry => {
          historyDiv.innerHTML += `
            <p><b>${territory.name}</b> (${entry.timestamp}):<br>
            –î–∞—Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è: ${entry.received || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}, 
            –î–∞—Ç–∞ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è: ${entry.processed || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}, 
            –í—ñ—Å–Ω–∏–∫: ${entry.bulletin || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}, 
            –î–æ–¥–∞—Ç–∫–æ–≤–æ: ${entry.additional || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}</p>
          `;
        });
      });
    }

    // –ï–∫—Å–ø–æ—Ä—Ç —ñ—Å—Ç–æ—Ä—ñ—ó
    document.getElementById('export-history').addEventListener('click', () => {
      const historyContent = territories.map(territory => 
        territory.history.map(entry => 
          `${territory.name} (${entry.timestamp}):\n` +
          `–î–∞—Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è: ${entry.received || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}\n` +
          `–î–∞—Ç–∞ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è: ${entry.processed || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}\n` +
          `–í—ñ—Å–Ω–∏–∫: ${entry.bulletin || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}\n` +
          `–î–æ–¥–∞—Ç–∫–æ–≤–æ: ${entry.additional || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}\n`
        ).join('\n')
      ).join('\n');
      const blob = new Blob([historyContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'history.txt';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
